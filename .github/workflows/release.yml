# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Release

#on:
#  push:

on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+'

jobs:
  mac_release:
    runs-on: macos-latest
    steps:
      - name: Check out a copy of the repository
        uses: actions/checkout@v2

      - name: Build
        run: ./build.sh --config Release --build_shared_lib --parallel --skip_tests --cmake_extra_defines CMAKE_OSX_ARCHITECTURES=x86_64

      - name: Copy, strip, and zip binary
        run: |
          ./tools/ci_build/github/linux/copy_strip_binary.sh -r build/MacOS -a onnxruntime-osx-x86_64-1.14.0 -l libonnxruntime.1.14.0.dylib -c Release -s ./
          tar -cvzf onnxruntime-osx-x86_64-1.14.0.tgz build/MacOS/onnxruntime-osx-x86_64-1.14.0

      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          files: onnxruntime-osx-x86_64-1.14.0.tgz

#  linux_release:
#    runs-on: ubuntu-latest
#    steps:
#      - name: Check out a copy of the repository
#        uses: actions/checkout@v2
#      - name: build
#        run: ./build.sh --config Release --build_shared_lib --parallel --skip_tests
#      - uses: actions/upload-artifact@v3
#        with:
#          path: build/Linux/Release/libonnxruntime.so.1.14.0
#      - uses: actions/upload-artifact@v3
#        with:
#          path: build/Linux/Release/libonnxruntime.so

#  windows_release:
#    runs-on: windows-2019
#    steps:
#      - name: Check out a copy of the repository
#        uses: actions/checkout@v2
#      - uses: seanmiddleditch/gha-setup-vsdevenv@master
#      - name: build
#        run: .\build.bat --config Release --build_shared_lib --parallel --skip_tests
#      - uses: actions/upload-artifact@v3
#        with:
#          path: build/Windows/Release/onnxruntime.dll